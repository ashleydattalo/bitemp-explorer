<export><workspace name="MLWdemo"><query name="EvaBuy2001" focus="false" active="true" mode="javascript">declareUpdate();

// Eva buys house 2001 recorded 2001

var root = {
"sysStart": null,
"sysEnd": null,
"valStart": "2001-01-01T00:00:00Z",
"valEnd": "2010-01-01T00:00:00Z",
"data": "Eva"}
    
temporal.documentInsert("temporal","addr.json",root)
temporal.statementSetSystemTime("2001-01-01T00:00:00Z")</query><query name="PeterBuy2004" focus="false" active="true" mode="javascript">declareUpdate();

// Eva buys house 2001 recorded 2001
// Peter buys house 2004 recorded 2004

var root = {
"sysStart": null,
"sysEnd": null,
"valStart": "2004-01-01T00:00:00Z",
"valEnd": "2010-01-01T00:00:00Z",
"data": "Peter"}
    
temporal.documentInsert("temporal","addr.json",root)
temporal.statementSetSystemTime("2004-01-01T00:00:00Z")</query><query name="PeterSell2006" focus="false" active="true" mode="javascript">declareUpdate();

// Eva buys house 2001 recorded 2001
// Peter buys house 2004 recorded 2004
// Peter sells house 2006 recorded 2006

var root = {
"sysStart": null,
"sysEnd": null,
"valStart": "2006-01-01T00:00:00Z",
"valEnd": "2010-01-01T00:00:00Z",
"data": null}
    
temporal.documentInsert("temporal","addr.json",root)
temporal.statementSetSystemTime("2006-01-01T00:00:00Z")</query><query name="EvaBuy2002" focus="false" active="true" mode="javascript">declareUpdate();
var result = 
cts.search(
  cts.andQuery([
    cts.jsonPropertyValueQuery("data","Eva"),
    cts.periodRangeQuery(
      "system","ALN_FINISHED_BY",
      cts.period(("9999-01-01T00:00:00Z"),("9999-12-31T23:59:59Z")))])
  ).toArray()

// Eva buys house 2001 recorded 2001
// Peter buys house 2004 recorded 2004
// Peter sells house 2006 recorded 2006
// Eva actually bought house 2002 recorded 2007

var doc = result[0].toObject();
doc.valEnd = "2002-01-01T00:00:00Z";
doc.data = null;
var str = 
  temporal.documentInsert(
    "temporal","addr.json",doc);
temporal.statementSetSystemTime("2007-01-01T00:00:00Z")
</query><query name="PeterBuy2005" focus="false" active="true" mode="javascript">declareUpdate();
var result = 
cts.search(
  cts.andQuery([
    cts.jsonPropertyValueQuery("data","Peter"),
    cts.periodRangeQuery(
      "system","ALN_FINISHED_BY",
      cts.period(("9999-01-01T00:00:00Z"),("9999-12-31T23:59:59Z")))])
  ).toArray()

// Eva buys house 2001 recorded 2001
// Peter buys house 2004 recorded 2004
// Peter sells house 2006 recorded 2006
// Eva actually bought house 2002 recorded 2007
// Peter actually bought house 2003 recorded 2009

var doc = result[0].toObject();
doc.valStart = "2003-01-01T00:00:00Z";
var str = 
  temporal.documentInsert(
    "temporal","addr.json",doc);
temporal.statementSetSystemTime("2009-01-01T00:00:00Z")
</query><query name="Query 2" focus="false" active="false" mode="javascript">// query</query><query name="delete" focus="false" active="true" mode="javascript">declareUpdate();
temporal.documentDelete("temporal","addr.json")
temporal.statementSetSystemTime("2010-01-01T00:00:00Z")</query><query name="configure" focus="true" active="true" mode="javascript">declareUpdate();
var temporal=require("/MarkLogic/temporal.xqy");
 
temporal.axisCreate("valid",
       cts.elementReference("valStart"),cts.elementReference("valEnd"))
temporal.axisCreate("system",
      cts.elementReference("sysStart"),cts.elementReference("sysEnd"))// query</query><query name="configure2" focus="false" active="true" mode="javascript"> declareUpdate();
var temporal=require("/MarkLogic/temporal.xqy");
 
temporal.collectionCreate("temporal","system","valid");</query></workspace></export>
